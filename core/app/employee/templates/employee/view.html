{% extends 'base.html' %}
{% load static %}

{% block title %}
  LGU Admin Employee - Bayan ng Labo
{% endblock %}

{% block main %}
  <div class="drawer lg:drawer-open bg-stone-100 min-h-screen">
    <input id="sidebar" type="checkbox" class="drawer-toggle" />

    <div class="drawer-content flex flex-col">
      {% include 'navbar.html' %}

      <main class="flex-1">
        <!-- Header -->
        <div class="bg-green-500 h-16 flex items-end justify-end px-4 md:px-6">
          <h1 class="text-lg md:text-2xl lg:text-3xl font-bold text-white pb-3">LGU - EMPLOYEE LIST</h1>
        </div>

        <!-- Messages -->
        {% if messages %}
          <div class="px-4 md:px-6 mt-6">
            {% for message in messages %}
              <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %} shadow-lg mb-3">
                <span>{{ message }}</span>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Content -->
        <div class="p-4 md:p-6 lg:p-8">
            <div class="bg-white lg:p-10 p-2  shadow-md rounded-lg overflow-hidden">
                <!-- Add Button -->
                <div class="p-4 border-b border-gray-200 flex justify-between items-center flex-wrap gap-3">
                <h2 class="text-lg font-semibold text-gray-800">Employee List</h2>
                 <a href="{% url 'employee:create' %}" class="btn btn-info btn-sm md:btn-md">
                    <i class="fas fa-plus"></i> <span class="hidden sm:inline">Add Employee</span>
                </a>
                </div>

                <!-- Table Container -->
                <div class="overflow-x-auto">
             
                <table id="employeetable" class="table table-zebra w-full">
  <thead class="text-green-500 ">
    <tr>
      <th>ID No.</th>
      <th>Full Name</th>
      <th>Position</th>
      <th>Department</th>
      <th class="text-center">Actions</th>   <!-- column index 4 -->
    </tr>
  </thead>
  <tbody>
    {% for emp in employee %}
    <tr>
      <td>{{ emp.employee_id|default:"—" }}</td>
     <td>{{emp.last_name}} {{emp.first_name}}
                            {% if emp.middle_name %}
                              {{emp.middle_name}} 
                            {% endif %}
                            {% if emp.name_ext %}
                              {{emp.name_ext}}
                            {% endif %}
                            </td>
      <td>{{ emp.position.title|default:"—" }}</td>
      <td>{{ emp.department.name|default:"—" }}</td>
      <td class="text-center">
        <div class="flex justify-center gap-2">
          <a href="{% url 'employee:show' emp.id %}" class="flex justify-center items-center">
               <i class="fas fa-eye text-blue-500"></i>
            
          </a>
          <a href="{% url 'employee:edit' emp.id %}"   class="flex justify-center items-center">
               <i class="fas fa-edit text-yellow-500"></i>
          </a>
            <button type="button" empid = "{{emp.id}}" class="deleteEmployee flex justify-center items-center"
                   >
              <i class="fas fa-trash-alt text-red-500"></i>
            </button>

        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
                </div>
            </div>
        </div>
      </main>
    </div>
<dialog id="my_modal_5" class="modal modal-bottom sm:modal-middle">
  <div class="modal-box">
    <h3 class="font-bold text-lg text-red-700">Confirm Deletion</h3>
    <p class="py-4">Are you sure you want to delete this employee? This action cannot be undone.</p>

    <div class="modal-action">
      <form method="dialog" class="inline">
        <button class="btn btn-warning">Cancel</button>
      </form>

      <form method="post" action="{% url 'employee:destroy' %}" class="inline">
        {% csrf_token %}
        <input type="hidden" name="id" id="empsid">
        <button type="submit" class="btn btn-error">Delete</button>
      </form>
    </div>
  </div>
</dialog>
    {% include 'sidebar.html' %}
  </div>
{% endblock %}
{% block scripts %}
<script>
  $(document).ready(function () {
    $('#employeetable').DataTable({
      pageLength: 10,
      lengthMenu: [10, 25, 50, 100],
      order: [[1, 'asc']], // Sort by name
      columnDefs: [
        { orderable: false, targets: 4 } // Disable sorting on Actions
      ],
      language: {
        search: "Search employees:",
        lengthMenu: "Show _MENU_ entries",
        info: "Showing _START_ to _END_ of _TOTAL_ employees",
        paginate: {
          next: "Next",
          previous: "Previous"
        }
      }
    });
  $(".deleteEmployee").click(function(event) {
    let id = $(event.currentTarget).attr("empid");
    $("#empsid").val(id)
    my_modal_5.showModal();
  });
  setTimeout(function() {
      $('.alert').fadeOut(800);  // 800ms fade out animation
    }, 2000);
  });
</script>
{% endblock scripts %}
