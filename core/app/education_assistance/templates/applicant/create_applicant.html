{% extends 'base.html' %}
{% load static %}

{% block title %}
  LGU Admin Education - Bayan ng Labo
{% endblock %}

{% block main %}
  <div class="drawer lg:drawer-open bg-stone-100 min-h-screen">
    <input id="sidebar" type="checkbox" class="drawer-toggle" />

    <div class="drawer-content flex flex-col">
      {% include 'navbar.html' %}

      <main class="flex-1">
            <div class="bg-green-500 h-16 flex items-end justify-end px-4 md:px-6">
          <h1 class="text-lg md:text-2xl lg:text-3xl font-bold text-white pb-3"><a href="">EDUCATION ASSISTANCE</a></h1>
        </div>
           <div class="p-4 md:p-6 lg:p-8">
          <div class="bg-white lg:p-10 p-2 shadow-md rounded-lg overflow-hidden">
                  <div class="p-4 border-b border-gray-200 gap-3">
              <h2 class="text-2xl text-center font-semibold text-gray-800">Create new Scholar</h2>
              
            </div>
 <section class="p-5">
        <form action="" id="form" method="post" novalidate>
            {% csrf_token %}

            <!-- NAME ROW -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        First Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="fname" value="{{ fName|default_if_none:'' }}" placeholder="John Jester"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.fName or errors.datas %}border-red-500{% endif %}" />
                               {% if errors.datas %}<p class="mt-1 text-sm text-red-600">{{ errors.datas }}</p>{% endif %}
                    {% if errors.fName %}<p class="mt-1 text-sm text-red-600">{{ errors.fName }}</p>{% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Middle Name</label>
                    <input type="text" name="mname" value="{{ mName|default_if_none:'' }}" placeholder="Hagupit"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.mName %}border-red-500{% endif %}" />
                    {% if errors.mName %}<p class="mt-1 text-sm text-red-600">{{ errors.mName }}</p>{% endif %}
                </div>

               <div class="w-full flex gap-3">
                 <div class="w-full">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Last Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="lname" value="{{ lName|default_if_none:'' }}" placeholder="Salen"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.lName or errors.datas %}border-red-500{% endif %}" />
                    {% if errors.datas %}<p class="mt-1 text-sm text-red-600">{{ errors.datas }}</p>{% endif %}
                           {% if errors.lName %}<p class="mt-1 text-sm text-red-600">{{ errors.lName }}</p>{% endif %}
                </div>
                <div class="w-1/3">
                     <label class="block text-sm font-medium text-gray-700 mb-1">
                        Name Ext. 
                    </label>
                    <input type="text" name="name_ext" value="{{ name_ext|default_if_none:'' }}" placeholder="Jr, I,II,III"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.name_ext or errors.datas %}border-red-500{% endif %}" />
                </div>
               </div>
            </div>

            <!-- EMAIL & CONTACT & 4PS ROW -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email <span class="text-red-500">*</span></label>
                    <input type="email" name="email" id="email" value="{{ email|default_if_none:'' }}" placeholder="johndoe@gmail.com"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.email %}border-red-500{% endif %}" />
                    {% if errors.email %}<p class="mt-1 text-sm text-red-600">{{ errors.email }}</p>{% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contact No. <span class="text-red-500">*</span></label>
                    <input type="tel" name="contact" value="{{ contact|default_if_none:'' }}" placeholder="09xxxxxxxxx"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.contact %}border-red-500{% endif %}" />
                    {% if errors.contact %}<p class="mt-1 text-sm text-red-600">{{ errors.contact }}</p>{% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">4Ps Beneficiary <span class="text-red-500">*</span></label>
                    <select name="is_four" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.is_four %}border-red-500{% endif %}">
                        <option value="" disabled {% if not is_four %}selected{% endif %}>Select</option>
                        <option value="1" {% if is_four == "1" %}selected{% endif %}>Yes</option>
                        <option value="0" {% if is_four == "0" %}selected{% endif %}>No</option>
                    </select>
                    {% if errors.is_four %}<p class="mt-1 text-sm text-red-600">{{ errors.is_four }}</p>{% endif %}
                </div>
            </div>

            <!-- GRADE & SCHOOL ROW -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Year/Grade <span class="text-red-500">*</span></label>
                    <input type="text" name="grade" value="{{ grade|default_if_none:'' }}" placeholder="Grade 8, Grade 12-STEM, 1st Year BSCS"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.grade %}border-red-500{% endif %}" />
                    {% if errors.grade %}<p class="mt-1 text-sm text-red-600">{{ errors.grade }}</p>{% endif %}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">School <span class="text-red-500">*</span></label>
                    <input type="text" name="school" value="{{ school|default_if_none:'' }}" placeholder="Mabini Colleges"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.school %}border-red-500{% endif %}" />
                    {% if errors.school %}<p class="mt-1 text-sm text-red-600">{{ errors.school }}</p>{% endif %}
                </div>
            </div>

            <!-- ADDRESS -->
               <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Province/City <span class="text-red-500">*</span></label>
                    <input type="text" name="province"  value="Labo Camarines Norte"  placeholder="Camarines Norte"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.province %}border-red-500{% endif %}" />
                    {% if errors.province %}<p class="mt-1 text-sm text-red-600">{{ errors.province }}</p>{% endif %}
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Barangay <span class="text-red-500">*</span></label>
                    <select name="brgy" id="" class="w-full select {% if errors.brgy %}border-red-500{% endif %}">
                        <option value="" selected disabled>Select Barangay</option>
                        
                        {% for barangay in brgys  %}
                            <option value="{{barangay.id}}" 
                            {% if brgy == barangay.id %}
                               selected 
                            {% endif %}
                                >{{barangay.name}}</option>
                        {% endfor %}
                            
                    </select>
             {% if errors.brgy %}<p class="mt-1 text-sm text-red-600">{{ errors.brgy }}</p>{% endif %}
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Purok <span class="text-red-500">*</span></label>
                    <input type="text" name="purok"  value="{{ school|default_if_none:'' }}"  placeholder="Purok 1"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 {% if errors.purok %}border-red-500{% endif %}" />
                    {% if errors.purok %}<p class="mt-1 text-sm text-red-600">{{ errors.purok }}</p>{% endif %}
                </div>
               
            </div>

            <!-- SUBMIT BUTTON -->
            <div class="text-center">
                <button type="submit" id="submit-btn"
                        class="px-6 py-3 bg-green-500 text-white font-semibold rounded-md shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                    SUBMIT APPLICATION
                </button>
            </div>
        </form>
    </section>
          </div>
           </div>

          </main>
          <!-- Confirmation Modal -->
<dialog id="confirm-modal" class="modal backdrop:bg-black/50">
    <div class="modal-box max-w-2xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
        </form>
        <h3 class="text-lg font-bold mb-4">Confirm Your Application</h3>
        <div id="modal-content" class="space-y-4 text-sm">
            <!-- Content will be filled dynamically by JS -->
        </div>
        <div class="modal-action mt-6">
            <form method="dialog">
                <button class="btn btn-ghost">Cancel</button>
            </form>
            <button id="confirm-submit" class="btn btn-success">Confirm & Submit</button>
        </div>
    </div>
</dialog>
    </div>

    {% include 'sidebar.html' %}
  </div>
{% endblock %}
{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('form');
        const modal = document.getElementById('confirm-modal');
        const modalContent = document.getElementById('modal-content');
        const confirmSubmitBtn = document.getElementById('confirm-submit');
           const errorAlert = document.getElementById('error-alert-container');
      
 // --- Alert Fading Logic ---
        if (errorAlert) {
            // Wait for 3 seconds before starting the fade
            setTimeout(() => {
                // Start the CSS transition (opacity-100 -> opacity-0)
                errorAlert.classList.remove('opacity-100');
                errorAlert.classList.add('opacity-0');

                // Wait for the transition duration (1000ms or 1 second) before removing the element entirely
                setTimeout(() => {
                    errorAlert.remove();
                }, 1000);
            }, 3000); // 3000ms = 3 seconds delay
        }
        form.addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent immediate submission
            const brgySelect = form.brgy;
            const brgyText = brgySelect.options[brgySelect.selectedIndex].text;
            // Populate modal with form data for review
            modalContent.innerHTML = `
                <p><strong>Name:</strong> ${form.fname.value} ${form.mname.value || ''} ${form.lname.value}</p>
                <p><strong>Email:</strong> ${form.email.value}</p>
                <p><strong>Contact:</strong> ${form.contact.value}</p>
                <p><strong>4Ps Beneficiary:</strong> ${form.is_four.value === '1' ? 'Yes' : 'No'}</p>
                <p><strong>Year/Grade:</strong> ${form.grade.value}</p>
                <p><strong>School:</strong> ${form.school.value}</p>
                <p><strong>Address:</strong> ${form.purok.value} ${brgyText}, ${form.province.value} </p>
            `;

            modal.showModal();
        });

        // Confirm submission
        confirmSubmitBtn.addEventListener('click', function () {
            form.submit(); // Now actually submit the form
        });
    });
</script>
{% endblock %}